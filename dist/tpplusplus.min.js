/*! tpplusplus - v0.0.1 - 2014-03-28
* https://github.com/techdotpro/tpplusplus
* Copyright (c) 2014 ;*/
!function(){"use strict";function a(a,c){return function(){b.Frames.on(["widgets",a._instanceId,a._name,c].join("."),{topic:a._name+"."+c,id:a._instanceId,data:a.data},function(b){a.on[c].call(a,b)})}}"function"!=typeof Object.create&&!function(){var a=function(){};Object.create=function(b){return a.prototype=b,new a}}(),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e});var b={};b.Core={},b.UI={},b.UI.Widgets={},b.Utils={},b.DOM={},b.Frames={};var c=function(a,b){for(var c,d=/{{(\s*[\w\.]+\s*)}}/g,e=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,f="var r=[];\n",g=0,h=function(a,b){return f+=b?a.match(e)?a+"\n":"r.push(this."+a+");\n":""!==a?"r.push('"+a.replace(/"/g,'\\"')+"');\n":"",h};c=d.exec(a);)h(a.slice(g,c.index))(c[1],!0),g=c.index+c[0].length;return h(a.substr(g,a.length-g)),f+='return r.join("");',new Function(f.replace(/[\r\t\n]/g,"")).apply(b)};b.events={},function(a){var b={},c=-1;a.on=function(a,d){b[a]||(b[a]=[]);var e=(++c).toString();return b[a].push({token:e,func:d}),e},a.emit=function(a,c){return b[a]?(setTimeout(function(){for(var d=b[a],e=d?d.length:0;e--;)d[e].func(c,{topic:a,data:c,timestamp:new Date})},0),!0):!1},a.off=function(a){for(var c in b)if(b[c])for(var d=0,e=b[c].length;e>d;d++)if(b[c][d].token===a)return b[c].splice(d,1),a;return!1}}(b.events),b.$=function(){return document.querySelectorAll.apply(document,arguments)},b.$.on=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},b.DOM.insertWidget=function(a,c){var d,e=document.createElement(a.tagName);e.className=a.className;for(d in a.events)b.$.on(e,d,function(b){a.events[d].call(a,b)});c.parentNode.replaceChild(e,c),a.element=e,a.update()},b.DOM.updateWidget=function(a,b){a.element.innerHTML=b},b.Frames.on=function(a,c,d){b.events.on(a,function(a){c.eventData=a,f.contentWindow.postMessage(JSON.stringify(c),"*")}),b.events.on(a+".done",function(a){d(a)})};var d,e=function(a){if("http://oil.com"===a.origin||"http://oilpro.com"===a.origin){var c=document.createElement("pre");c.style.display="block",c.innerHTML=a.data,document.documentElement.appendChild(c);var e=JSON.parse(a.data);e.member&&"undefined"==typeof d&&(b.events.emit("user.auth",e.member),d=!0,b.events.emit("frame.ready")),e.topic&&b.events.emit(e.topic,e.data),d=!1}};b.$.on(window,"message",e);var f=b.Frames.main=document.createElement("iframe");b.Frames.initialize=function(){f.width=0,f.height=0,f.style.display="none",f.src="http://oil.com/widget/button",document.documentElement.appendChild(f)},b.user=null,b.events.on("user.auth",function(a){b.user=a});var g={},h=[],i=0;b.UI.Widgets.BaseWidget=function(){this.template="",this.data={}},b.UI.Widgets.BaseWidget.prototype.update=function(){b.DOM.updateWidget(this,c(this.template,this.data))},b.UI.Widgets.register=function(a,c){g[a]=c,c.prototype=Object.create(b.UI.Widgets.BaseWidget.prototype),c.prototype.constructor=c},b.UI.Widgets.BaseWidget.prototype.emit=function(a,c){b.events.emit(["widgets",this._instanceId,this._name,a].join("."),c)},b.UI.Widgets.scan=function(){var a,c,d=[];for(a in g){if(c=document.getElementsByTagName("tp-"+a.toLowerCase()),c.length)for(var e=0,f=c.length;f>e;e++)d.push(c[e]);d.length&&b.UI.Widgets.loadWidgets(a,d)}},b.UI.Widgets.loadWidgets=function(a,b){var c,d;for(c=0,d=b.length;d>c;c++){var e=new g[a](b[c]),f=++i;h.push(e),e._name=a.toLowerCase(),e._instanceId=f,this.loadWidget(e,b[c])}},b.UI.Widgets._instances=h;var j=[];b.UI.Widgets.loadWidget=function(c,d){var e;if(b.DOM.insertWidget(c,d),c.on)for(e in c.on)j.push(a(c,e))},b.events.on("frame.ready",function(){var a;for(a=0;a<j.length;a++)j[a]();for(a=0;a<h.length;a++)h[a].initialize()}),b.UI.Widgets.register("PlusPlus",function(a){this.tagName="a",this.data={count:0,url:a.getAttribute("data-href")||window.location.href},this.template='<img class="bookmarklet-ico" src="http://tpstatic.com/img/root/techpro/favicon.ico"><span class="bookmarklet-inner">TP++</span><span class="count">{{count}}</span>',this.className="btn-bookmarklet pull-left",this.events={click:function(){this.data.count++,this.update(),this.emit("countUpdate")}},this.on={countUpdate:function(a){this.data.count=a.count,this.update()},foo:function(a){console.log("some damn foo:"+a.bar)}},this.initialize=function(){this.emit("countUpdate")}});var k='body {font-family: "museo-sans","Helvetica Neue",Helvetica,Arial,sans-serif;} .btn-bookmarklet .bookmarklet-inner{font-size:14px;line-height:16px;font-weight:700;color:#444;vertical-align:middle;display:inline-block}Inherited from a#bookmarklet.btn-bookmarklet.pull-left .btn-bookmarklet{}.btn-bookmarklet{display:inline-block;margin-top:1px;-moz-box-shadow:#ddd 1px 1px 4px;-webkit-box-shadow:#ddd 1px 1px 4px;box-shadow:#ddd 1px 1px 4px;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;padding:5px 6px;background-color:#fafafa;border:1px solid #aaa;}a{cursor:pointer;color:#457bbe}.btn-bookmarklet .bookmarklet-ico{width:16px;height:16px}a img{border:0}img{max-width:100%;vertical-align:middle;border:0;-ms-interpolation-mode:bicubic}',l=document.head||document.getElementsByTagName("head")[0],m=document.createElement("style");m.type="text/css",m.styleSheet?m.styleSheet.cssText=k:m.appendChild(document.createTextNode(k)),l.appendChild(m),b.UI.Widgets.scan(),b.Frames.initialize(),window.TP=b}();